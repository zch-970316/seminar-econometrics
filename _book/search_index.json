[["index.html", "高级计量暑期研讨 前言", " 高级计量暑期研讨 胡华平 2022-06-23 前言 你好，世界(Hello World！)。 "],["background-info.html", "第 1 章 背景资料 参考文献", " 第 1 章 背景资料 先介绍一下课程 参考文献 "],["RDD-lab-mean-est.html", "第 2 章 RDD Lab01 非参数估计: 均值估计 2.1 基本原理 2.2 案例说明 2.3 操作过程", " 第 2 章 RDD Lab01 非参数估计: 均值估计 2.1 基本原理 2.1.1 为什么要进行均值估计？ 对于计量模型： \\[\\begin{align} Y &amp;= m(X) +e \\end{align}\\] 研究者首先需要关注的是 条件期望函数（Conditional Expectation Function ,CEF）： \\[\\begin{align} \\mathbb{E}[Y|X=x] \\equiv m(x) \\end{align}\\] 此时： \\[\\begin{align} Y &amp; = m(X) +e \\\\ &amp; = \\mathbb{E}[Y|X=x] + e \\end{align}\\] 2.1.2 什么是非参数估计？ 理论上，条件期望函数 \\(m(x)\\)可以表现为明确的参数化形式（parametric function），也可以表现为任意的非参数化形式（non-parametric function）。 常见的参数化条件期望函数，例如线性形式： \\[Y= m(x) +e = \\beta_0 +\\beta_1 X +e\\] 非参数回归模型（nonparametric regression model）：假定条件期望函数表现为任意的非参数化形式的回归模型。 非参数回归模型可以表达为： \\[\\begin{align} Y = \\mathbb{E}(Y|X=x) + e &amp;=m(x) +e \\\\ \\mathbb{E}(e|X=x) &amp;= 0 \\\\ \\mathbb{E}(e^2|X=x) &amp;= \\sigma^2(X) \\end{align}\\] 此时，我们的目标就是估计得到条件期望函数 \\(\\widehat{m}(x)\\)。 2.1.3 箱组均值估计：表达式 对于非参数模型： \\[\\begin{align} Y = \\mathbb{E}(Y|X=x) + e &amp;=m(x) +e \\end{align}\\] 我们可以直接把数据集划分为不同箱组（bins），然后简单地计算各个箱组中 \\(Y_i\\)的均值。 \\[\\begin{align} \\hat{m}(x)=\\frac{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\} \\cdot Y_{i}}{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\}} \\end{align}\\] 其中： \\(\\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\}\\)为指示函数，取值为 \\(\\{0,1\\}\\)，以表明 \\(X_i\\)是否落在特定箱组内 以上公式可以简单视作为箱组内的简单算数平均数公式 2.1.4 箱组均值估计：操作步骤 箱组均值估计（Binned Estimator）的操作步骤如下： 根据计算点 \\(X=x_j\\)，按照特定谱宽 \\(h\\)，划分出若干箱组（bins）： \\(\\{b_1,b_2,\\cdots,b_q\\}\\) \\[b_{j}=[x_j-h,x_j +h] \\] 根据样本数据集，以及 \\(X_i\\)的实际情况，确定数据对 \\(\\{X_i, Y_i\\}\\)的箱组归属： \\[\\mathbb{1}\\left\\{\\left|X_{i}-x_j\\right| \\leq h\\right\\}\\] 最后计算不同箱组的 \\(Y_i\\)的均值 \\(\\widehat{m}(x_{b_j}),j \\in (1,2,\\cdots,q)\\)： \\[\\begin{align} \\hat{m}(x)=\\frac{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\} \\cdot Y_{i}}{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\}} \\end{align}\\] 2.1.5 滚动箱组均值估计：定义及表达式 滚动箱组均值估（The rolling binned means estimator）：以系列数值 \\(x\\)为中心，以 \\(h\\)为谱宽，滚动构建一系列箱组（箱组会有重叠），并分别计算出系列箱组的均值。 \\[\\begin{align} \\hat{m}(x)=\\frac{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\} \\cdot Y_{i}}{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\}} \\end{align}\\] 我们后面马上会介绍，滚动箱组均值估实际上是一类特殊的核估计（kernel）情形，具体为Nadaraya-Watson 矩形和估计（NW rectangular kernel estimator）。 2.1.6 滚动箱组均值估计：操作过程 滚动箱组均值估计（Rolling Binned Estimator）的操作步骤如下： 根据计算点 \\(X=x_j\\)，按照特定谱宽 \\(h\\)，划分出若干箱组（bins）（箱组会有重叠）： \\(\\{b_1,b_2,\\cdots,b_q\\}\\) \\[b_{j}=[x_j-h,x_j +h] \\] 根据样本数据集，以及 \\(X_i\\)的实际情况，确定数据对 \\(\\{X_i, Y_i\\}\\)的箱组归属： \\[\\mathbb{1}\\left\\{\\left|X_{i}-x_j\\right| \\leq h\\right\\}\\] 最后计算不同箱组的 \\(Y_i\\)的均值 \\(\\widehat{m}(x_{b_j}),j \\in (1,2,\\cdots,q)\\)： \\[\\begin{align} \\hat{m}(x)=\\frac{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\} \\cdot Y_{i}}{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\}} \\end{align}\\] 2.1.7 核估计：回顾与思考 上述两种箱组均值估计的公式中： \\[\\begin{align} \\hat{m}(x)=\\frac{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\} \\cdot Y_{i}}{\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\}} \\end{align}\\] 对条件期望的估计 \\(\\widehat{m}(x)\\)结果都呈现一定的锯齿形态（jagged），也即估计结果不太平滑（smoothed）。 思考： 为什么估计结果会呈现不太平滑的锯齿形态？ 能不能让估计结果更加平滑呢？ – 回答： 问题的关键在于上面的估计公式使用了箱组指示函数（可视作为权重） \\(\\sum_{i=1}^{n} \\mathbb{1}\\left\\{\\left|X_{i}-x\\right| \\leq h\\right\\}\\)，而这个权重函数本身是跳跃的。 有没有一种办法能够基于平滑的权重函数来计算CEF的估计值呢？ 2.1.8 核估计：概念 核估计（kernel estimator）：基于多种类型的核函数（kernel function）作为权重函数——可以是连续的，也可以是跳跃的——来估计条件期望函数 \\(\\widehat{m}(x)\\)的一种估计方法。 \\[\\begin{align} \\hat{m}_{\\mathrm{nw}}(x)=\\frac{\\sum_{i=1}^{n} K\\left(\\frac{X_{i}-x}{h}\\right) Y_{i}}{\\sum_{i=1}^{n} K\\left(\\frac{X_{i}-x}{h}\\right)} \\end{align}\\] 其中： \\(K(u)\\)为核函数（kernel function） 2.1.9 核估计：特点 \\[\\begin{align} \\hat{m}_{\\mathrm{nw}}(x)=\\frac{\\sum_{i=1}^{n} K\\left(\\frac{X_{i}-x}{h}\\right) Y_{i}}{\\sum_{i=1}^{n} K\\left(\\frac{X_{i}-x}{h}\\right)} \\end{align}\\] 尽管这里使用了核函数来计算权重，但是本质上上述公式还是利用了箱组估计的方法，也即把箱组计算值作为这一箱组的代表值。 以上估计方法也被称为局部常数估计（local constant estimator）或NW估计（Nadaraya-Watson estimator） 容易发现前述箱组均值估计和滚动箱组均值估计都是局部常数估计（local constant estimator）的两个特例。 2.1.10 核估计：核函数定义 定义：若满足如下条件，则可称之为核函数（Kernel function） \\(K(u)\\) \\(0 \\leq K(u) \\leq \\bar{K}&lt;\\infty\\), \\(K(u)=K(-u)\\), \\(\\int_{-\\infty}^{\\infty} K(u) d u=1\\), 对所有的正整数 \\(r\\)都有 \\(\\int_{-\\infty}^{\\infty}|u|^{r} K(u) d u&lt;\\infty\\) 定义：正规化核函数（normalized kernel function）需满足 \\[\\int_{-\\infty}^{\\infty} u^2K(u) d u=1\\] 核函数本质上是一种边界约束的概率密度函数（bounded pdf） 核函数是原点对称的，且核函数为非负数（因此可用于权重） 2.1.11 核估计：常见的正规化核函数 矩形核函数（Rectangular Kernel）， \\(R_K= \\frac{1}{2\\sqrt{3}}\\) \\[\\begin{aligned} &amp;K(u)=\\left\\{\\begin{array}{cc} \\frac{1}{2 \\sqrt{3}} &amp; \\text { if }|u|&lt;\\sqrt{3} \\\\ 0 &amp; \\text { otherwise } \\end{array}\\right.\\\\ \\end{aligned}\\] 高斯核函数（Gaussian Kernel）， \\(R_K= \\frac{1}{2\\sqrt{\\pi}}\\) \\[\\begin{aligned} &amp;K(u)=\\frac{1}{\\sqrt{2 \\pi}} \\exp \\left(-\\frac{u^{2}}{2}\\right)\\\\ \\end{aligned}\\] 叶氏核函数（Epanechnikov Kernel）， \\(R_K= \\frac{3\\sqrt{5}}{25}\\) \\[\\begin{aligned} &amp;K(u)=\\left\\{\\begin{array}{cl} \\frac{3}{4 \\sqrt{5}}\\left(1-\\frac{u^{2}}{5}\\right) &amp; \\text { if }|u|&lt;\\sqrt{5} \\\\ 0 &amp; \\text { otherwise } \\end{array}\\right. \\end{aligned}\\] 三角核函数（Triangular Kernel）， \\(R_K= \\frac{\\sqrt{3}}{9}\\) \\[\\begin{aligned} &amp;K(u)=\\left\\{\\begin{array}{cl} \\frac{1}{\\sqrt{6}}\\left(1-\\frac{|u|}{\\sqrt{6}}\\right) &amp; \\text { if }|u|&lt;\\sqrt{6} \\\\ 0 &amp; \\text { otherwise } \\end{array}\\right. \\end{aligned}\\] 双权核函数（Biweight Kernel）， \\(R_K= \\frac{5\\sqrt{7}}{49}\\) \\[\\begin{aligned} K(u)=\\left\\{\\begin{array}{cl} \\frac{15}{16 \\sqrt{7}}\\left(1-\\frac{u^{2}}{7}\\right) &amp; \\text { if }|u|&lt;\\sqrt{7} \\\\ 0 &amp; \\text { otherwise } \\end{array}\\right. \\end{aligned}\\] 2.1.12 核估计：操作过程 NW核估计（NW Estimator）的操作步骤如下： 根据计算点 \\(X=x_j\\)，按照特定谱宽 \\(h\\)，划分出若干箱组（bins）（箱组会有重叠）： \\(\\{b_1,b_2,\\cdots,b_q\\}\\) \\[b_{j}=[x_j-h,x_j +h] \\] 根据样本数据集，以及 \\(X_i\\)的实际情况，计算特定核函数化的权重值： \\[K\\left(\\frac{X_{i}-x_j}{h}\\right)\\] 最后计算不同箱组的 \\(Y_i\\)的均值 \\(\\widehat{m}(x_{b_j}),j \\in (1,2,\\cdots,q)\\)： \\[\\begin{align} \\hat{m}_{\\mathrm{nw}}(x)=\\frac{\\sum_{i=1}^{n} K\\left(\\frac{X_{i}-x}{h}\\right) Y_{i}}{\\sum_{i=1}^{n} K\\left(\\frac{X_{i}-x}{h}\\right)} \\end{align}\\] 2.2 案例说明 source(here(&quot;Rscript/hensen21-fig19-1a.R&quot;), encoding = &quot;UTF-8&quot;) 2.2.1 模拟数据集 为了更好地进行数据验证，我们将根据如下规则生成蒙特卡洛模拟数据集： \\[\\begin{align} Y_i &amp;= m(X) +e_i =\\frac{sin(\\frac{\\pi}{4}\\cdot(X_i-2))}{\\frac{\\pi}{4}\\cdot(X_i-2)} +e_i\\\\ X_i &amp;\\sim U(0,10)\\\\ e_i &amp;\\sim N(0, 2)\\\\ n &amp;=100 \\end{align}\\] 此时，我们具有上帝视角，实际上已经知道数据生成机制（DGP） 此时，我们心里面已知真实模型为非线性的 n &lt;- 100 xm &lt;- 10 set.seed(180) # for reproducable xdat &lt;- runif(n,0,xm) a &lt;- pi/4 m &lt;- sin((xdat-2)*a)/((xdat-2)*a) ydat &lt;- m + rnorm(n)/4 dt &lt;- tibble(index = 1:length(xdat), X = xdat, Y = ydat) 2.2.2 样本数据集 dt %&gt;% #add_column(obs = 1:nrow(.), .before = &quot;X&quot;) %&gt;% DT::datatable( caption = paste0(&quot;模拟的样本数据集(n=&quot;,n,&quot;)&quot;), options = list(dom = &quot;tip&quot;, pageLength =8))%&gt;% formatRound(c(2:3), digits = 4) 样本数据的描述性统计如下： summary(dt) index X Y Min. : 1 Min. :0.1 Min. :-0.65 1st Qu.: 26 1st Qu.:2.3 1st Qu.:-0.06 Median : 50 Median :4.6 Median : 0.27 Mean : 50 Mean :4.9 Mean : 0.38 3rd Qu.: 75 3rd Qu.:7.5 3rd Qu.: 0.81 Max. :100 Max. :9.9 Max. : 1.46 2.2.3 样本数据散点图 # basic scatter plot p0 &lt;- ggplot() + geom_point(aes(X, Y),data = dt, pch=21) + labs(x= &quot;自变量X&quot;, y =&quot;因变量Y&quot;) + scale_x_continuous(breaks = seq(0,10,1), limits = c(0,10)) + scale_y_continuous(breaks = seq(-1,2,0.5), limits = c(-1,2)) + theme_bw() 2.3 操作过程 "],["appendix.html", "第 3 章 附录 3.1 常用stata命令", " 第 3 章 附录 3.1 常用stata命令 参看在线pdf 3.1.1 数列操作 命令1(2)9，得到：1, 3, 5, 7, 9 命令1/9，得到：1, 2, 3, 4, 5, 6, 7, 8, 9 3.1.2 时期操作 （1）滞后操作： L.表示滞后一期，例如L.x表示\\(x_{t-1}\\) L2.表示滞后2期，例如L2.x表示\\(x_{t-2}\\) （2）超前操作： F.表示滞后一期，例如F.x表示\\(x_{t+1}\\) F2.表示滞后2期，例如F2.x表示\\(x_{t+2}\\) （3）差分操作：D.或者D2.之类 （4）季节差分操作：S.或者S2.之类 3.1.3 条件下回归 命令regress var1 var2 if inrange(year,94,96)，表示仅使用部分数据（给定年份范围条件下）进行回归。 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
